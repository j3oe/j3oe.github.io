// === Typing Trainer ===
const typingModal = document.getElementById('typingModal');
const typingClose = document.getElementById('typingClose');
const typingText = document.getElementById('typingText');
const typingInput = document.getElementById('typingInput');
const typingStats = document.getElementById('typingStats');
const typingKeyboard = document.getElementById('typingKeyboard');

const czechKeys = "ěščřžýáíéqwertyuiopúasdfghjklůzxcvbnm".split('');
const words = ["česká","rychlá","liška","programování","káva","praha","zábava","přátelé","škola","řeka","město"];
let startTime, target, correctCount, typedCount;

function buildKeyboard(){
  typingKeyboard.innerHTML='';
  czechKeys.forEach(k=>{
    const key=document.createElement('div');
    key.className='key';
    key.textContent=k;
    typingKeyboard.appendChild(key);
  });
}

function highlightKey(char){
  document.querySelectorAll('.key').forEach(k=>{
    k.classList.toggle('active', k.textContent===char.toLowerCase());
  });
}

function newText(){
  target = Array.from({length:25},()=>words[Math.floor(Math.random()*words.length)]).join(' ');
  typingText.innerHTML = target.split('').map(ch=>`<span>${ch}</span>`).join('');
  typingInput.value='';
  correctCount = typedCount = 0;
  startTime = Date.now();
}

function updateStats(){
  const minutes = (Date.now()-startTime)/60000;
  const wpm = Math.round((correctCount/5)/minutes) || 0;
  const acc = typedCount ? Math.round((correctCount/typedCount)*100) : 100;
  typingStats.textContent = `WPM: ${wpm} | Accuracy: ${acc}%`;
}

typingInput.addEventListener('input',()=>{
  const val = typingInput.value;
  typedCount = val.length;
  const spans = typingText.querySelectorAll('span');
  let correct = 0;
  spans.forEach((s,i)=>{
    if(i<val.length){
      if(val[i]===target[i]){ s.className='correct'; correct++; }
      else s.className='incorrect';
    } else s.className='';
  });
  correctCount = correct;
  updateStats();
  highlightKey(val.slice(-1));
  if(val===target) newText();
});

typingClose.addEventListener('click',()=>typingModal.style.display='none');

document.querySelectorAll('.project').forEach(p=>{
  p.addEventListener('click',()=>{
    if(p.dataset.project==="4"){
      projectModal.style.display="none";
      buildKeyboard();
      newText();
      typingModal.style.display="flex";
      typingInput.focus();
    }
  });
});
